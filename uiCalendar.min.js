/*
 * uiCalendar - lightweight JS calendar datepicker
 * @author Jiri Hybek <jiri.hybek@cryonix.cz> / Cryonix Innovations <www.cryonix.cz>
 */
var uiCalendar,uiCalendarAuto;uiCalendar=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D;E={};for(g in e){_=e[g];E[g]=_}l=null;D=null;A=null;c=null;m=null;f=false;b=[];w=function(e){e.setHours(0);e.setMinutes(0);e.setSeconds(0);return e.setMilliseconds(0)};N=function(e){var t,n;if(e.indexOf(".")>=0){t=e.split(".").reverse()}else if(e.indexOf("-")>=0){t=e.split("-")}else{throw"uiCalendar: Unsupported date format"}if(t.length!==3){throw"uiCalendar: Invalid date format"}n=new Date;n.setFullYear(parseInt(t[0].trim()));n.setMonth(parseInt(t[1].trim())-1);n.setDate(parseInt(t[2].trim()));w(n);return n};h=function(e){if(E.format==="-"){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}else if(E.format==="."){return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()}else{throw"Invalid date format"}};O=function(e,t,n,r){var i,s;i=document.createElement(e);s=t||{};for(g in s){_=s[g];i.setAttribute(g,_)}if(n!==null){i.innerHTML=n}if(r){r.appendChild(i)}return i};p=function(e,t){var n,r;r=0;n=0;while(e){r+=e.offsetTop||0;n+=e.offsetLeft||0;e=t?e.offsetParent:null}return{top:r,left:n}};M=function(){var e,t,n,r,s;e=new Date(D.getTime());e.setMonth(e.getMonth()+E.monthCount-1);i.innerHTML=E.monthLabels[D.getMonth()]+(e.getTime()!==D.getTime()?" - "+E.monthLabels[e.getMonth()]:"")+" "+D.getFullYear();s=[];for(n=0,r=b.length;n<r;n++){t=b[n];s.push(t.update())}return s};L=function(){if(E.range){E.inputFrom.value=h(A);E.inputTo.value=h(c)}else{E.input.value=h(A)}if(E.closeOnSelect){return a()}};d=function(e){if(!E.allowPast&&parseInt(e.getAttribute("data-time"))<l.getTime()){return false}if(!E.allowToday&&parseInt(e.getAttribute("data-time"))===l.getTime()){return false}if(!E.allowFuture&&parseInt(e.getAttribute("data-time"))>l.getTime()){return false}if(E.allowFrom&&parseInt(e.getAttribute("data-time"))<E.allowFrom.getTime()){return false}if(E.allowTo&&parseInt(e.getAttribute("data-time"))>E.allowTo.getTime()){return false}if(E.range){if(A===null||A!==null&&c!==null){A=new Date(parseInt(e.getAttribute("data-time")));return c=null}else if(parseInt(e.getAttribute("data-time"))>A.getTime()){c=new Date(parseInt(e.getAttribute("data-time")));return L()}}else{A=new Date(parseInt(e.getAttribute("data-time")));c=new Date(parseInt(e.getAttribute("data-time")));return L()}};v=function(e){return m=new Date(parseInt(e.getAttribute("data-time")))};y=function(e,t){var n,r,i,s,o,u,a,f,h,p,g;a=t.getMonth();t.setDate(1);t.setDate(1+(E.weekStart-t.getDay()));w(t);p=O("table",{"class":"ui-calendar-month"},null,e);o=O("thead",{},null,p);n=O("tbody",{},null,p);u=O("tr",{},null,o);s=[];f=O("tr",{},null,n);for(r=g=0;g<35;r=++g){if(r<7){O("th",{},E.dayLabels[t.getDay()],u)}if(t.getMonth()===a||E.fillSpaces){i=O("td",{},t.getDate(),f);i.setAttribute("data-time",t.getTime());i.addEventListener("click",function(e){d(e.toElement||e.target);return M()});i.addEventListener("mouseover",function(e){v(e.toElement||e.target);return M()});s.push(i)}else{i=O("td",{"class":"fill"},"&nbsp;",f);i.setAttribute("data-time",-1)}t.setDate(t.getDate()+1);if(t.getDay()===E.weekStart){f=O("tr",{},null,n)}}return h={update:function(){var e,t,n,r;r=[];for(t=0,n=s.length;t<n;t++){i=s[t];e=[];if(parseInt(i.getAttribute("data-time"))<l.getTime()){e.push("past")}if(parseInt(i.getAttribute("data-time"))===l.getTime()){e.push("today")}if(parseInt(i.getAttribute("data-time"))>l.getTime()){e.push("future")}if(!E.allowToday&&parseInt(i.getAttribute("data-time"))===l.getTime()||!E.allowPast&&parseInt(i.getAttribute("data-time"))<l.getTime()||!E.allowFuture&&parseInt(i.getAttribute("data-time"))>l.getTime()||E.allowFrom&&parseInt(i.getAttribute("data-time"))<E.allowFrom.getTime()||E.allowTo&&parseInt(i.getAttribute("data-time"))>E.allowTo.getTime()){e.push("disabled")}if(A&&parseInt(i.getAttribute("data-time"))===A.getTime()||A&&c&&parseInt(i.getAttribute("data-time"))>=A.getTime()&&parseInt(i.getAttribute("data-time"))<=c.getTime()){e.push("selected")}if(A&&!c&&m&&parseInt(i.getAttribute("data-time"))>A.getTime()&&parseInt(i.getAttribute("data-time"))<m.getTime()){e.push("selection")}r.push(i.setAttribute("class",e.join(" ")))}return r},destroy:function(){return p.parentElement.removeChild(p)}}};k=function(e,t){var n,r,i,s,o,u,a;for(s=0,u=b.length;s<u;s++){i=b[s];i.destroy()}b=[];for(r=o=0,a=E.monthCount||1;0<=a?o<a:o>a;r=0<=a?++o:--o){n=new Date(t.getTime());n.setMonth(n.getMonth()+r);b.push(y(e,n))}return M()};a=function(){if(!f){u.parentElement.removeChild(u)}return f=true};if(E.weekStart===void 0){E.weekStart=1}if(E.monthOffset===void 0){E.monthOffset=1}if(E.monthCount===void 0){E.monthCount=1}if(E.format===void 0){E.format="-"}if(!E.dayLabels){E.dayLabels=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}if(!E.monthLabels){E.monthLabels=["January","February","March","April","May","Jun","July","August","September","October","November","December"]}if(E.closeOnSelect===void 0){E.closeOnSelect=false}if(E.closeOnBlur===void 0){E.closeOnBlur=false}if(E.absolutePosition===void 0){E.absolutePosition=true}if(E.range===void 0){E.range=false}if(E.fillSpaces===void 0){E.fillSpaces=true}if(E.allowFuture===void 0){E.allowFuture=true}if(E.allowToday===void 0){E.allowToday=true}if(E.allowPast===void 0){E.allowPast=true}E.allowFrom=E.allowFrom?N(E.allowFrom):null;E.allowTo=E.allowTo?N(E.allowTo):null;l=new Date;w(l);if(E.startDate){A=N(E.startDate)}if(E.endDate){c=N(E.endDate)}D=E.initidalDate?N(E.initidalDate):new Date;if(E.range){if(!E.inputFrom||!E.inputTo){throw"Input fields (from & to) are not defined!"}if(E.inputFrom.value.trim()!==""&&E.inputTo.value.trim()!==""){A=N(E.inputFrom.value);c=N(E.inputTo.value);D=new Date(A)}}else{if(!E.input){throw"Input field are not defined!"}if(E.input.value.trim()!==""){A=N(E.input.value);c=new Date(A);D=new Date(A)}}u=O("div",{"class":"ui-calendar"},null,E.container);r=O("div",{"class":"ui-calendar-header"},null,u);n=O("div",{"class":"ui-calendar-body"},null,u);o=O("span",{"class":"ui-calendar-prev"},"◄",r);s=O("span",{"class":"ui-calendar-next"},"►",r);i=O("span",{"class":"ui-calendar-label"},null,r);o.addEventListener("click",function(){D.setMonth(D.getMonth()-1);return k(n,D)});s.addEventListener("click",function(){D.setMonth(D.getMonth()+1);return k(n,D)});u.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();return false});document.body.addEventListener("click",function(e){if(E.closeOnBlur){return a()}});k(n,D);if(E.popup){t=E.input||E.inputFrom;S=p(t,E.absolutePosition);x=S.left+Math.round(t.offsetWidth/2);T=S.top+Math.round(t.offsetHeight/2);C=0;if(T-u.offsetHeight<0){C=1}if(C===1&&x+u.offsetWidth>E.container.offsetWidth){C=2}if(C===2&&T+u.offsetHeight>E.container.offsetHeight){C=3}switch(C){case 0:u.style.left=x-Math.round(u.offsetWidth/2)+"px";u.style.top=T-u.offsetHeight-t.offsetHeight-5+"px";u.classList.add("ui-calendar-arrow-bot");break;case 1:u.style.left=x+Math.round(t.offsetWidth/2)+20+"px";u.style.top=T-Math.round(u.offsetHeight/2)+"px";u.classList.add("ui-calendar-arrow-left");break;case 2:u.style.left=x-Math.round(u.offsetWidth/2)+"px";u.style.top=T+t.offsetHeight+5+"px";u.classList.add("ui-calendar-arrow-top");break;case 3:u.style.left=x-Math.round(t.offsetWidth/2)-u.offsetWidth-20+"px";u.style.top=T-Math.round(u.offsetHeight/2)+"px";u.classList.add("ui-calendar-arrow-right")}u.classList.add("ui-calendar-arrow");u.classList.add("ui-calendar-popup")}return{getStartDate:function(){return A},getEndDate:function(){return c},close:function(){return a()},isClosed:function(){return f}}};uiCalendarAuto=function(e,t){var n,r,i,s,o,u;if(t==null){t={}}n=function(e){var n,r,i,s,o,u,a,f,l;i={};for(r in t){o=t[r];i[r]=o}i.closeOnSelect=true;i.closeOnBlur=true;i.container=i.parentContainer?e.parentElement:document.body;i.popup=true;if(t.range){i.inputFrom=e.querySelector(i.fromSelector||".start");i.inputTo=e.querySelector(i.toSelector||".end")}else{i.input=e}n=null;f=[i.input,i.inputFrom,i.inputTo];l=[];for(u=0,a=f.length;u<a;u++){s=f[u];if(!s){continue}s.addEventListener("focus",function(){if(!n||n&&n.isClosed()){return n=uiCalendar(i)}});s.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();return false});s.addEventListener("keydown",function(e){if(e.keyCode===27&&n){return n.close()}});s.classList.add("ui-calendar-input");l.push(s.setAttribute("pattern","^([0-9]{1,2}.( )?[0-9]{1,2}.( )?[0-9]{4}|[0-9]{4}-[0-9]{1,2}-[0-9]{1,2})$"))}return l};i=(t.parent||document).querySelectorAll(e);u=[];for(s=0,o=i.length;s<o;s++){r=i[s];u.push(n(r))}return u}