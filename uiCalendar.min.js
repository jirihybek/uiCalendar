/*
 * uiCalendar - lightweight JS calendar datepicker
 * @author Jiri Hybek <jiri.hybek@cryonix.cz> / Cryonix Innovations <www.cryonix.cz>
 */
var uiCalendar,uiCalendarAuto;uiCalendar=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;w={};for(m in e){O=e[m];w[m]=O}l=null;M=null;k=null;c=null;v=null;f=false;y=[];b=function(e){e.setHours(0);e.setMinutes(0);e.setSeconds(0);return e.setMilliseconds(0)};x=function(e){var t,n;if(e.indexOf(".")>=0){t=e.split(".").reverse()}else if(e.indexOf("-")>=0){t=e.split("-")}else{throw"uiCalendar: Unsupported date format"}if(t.length!==3){throw"uiCalendar: Invalid date format"}n=new Date;n.setFullYear(parseInt(t[0].trim()));n.setMonth(parseInt(t[1].trim())-1);n.setDate(parseInt(t[2].trim()));b(n);return n};h=function(e){if(w.format==="-"){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}else if(w.format==="."){return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()}else{throw"Invalid date format"}};L=function(e,t,n,r){var i,s;i=document.createElement(e);s=t||{};for(m in s){O=s[m];i.setAttribute(m,O)}if(n!==null){i.innerHTML=n}if(r){r.appendChild(i)}return i};A=function(){var e,t,n,r,s;e=new Date(M.getTime());e.setMonth(e.getMonth()+w.monthCount-1);i.innerHTML=w.monthLabels[M.getMonth()]+(e.getTime()!==M.getTime()?" - "+w.monthLabels[e.getMonth()]:"")+" "+M.getFullYear();s=[];for(n=0,r=y.length;n<r;n++){t=y[n];s.push(t.update())}return s};C=function(){if(w.range){w.inputFrom.value=h(k);w.inputTo.value=h(c)}else{w.input.value=h(k)}if(w.closeOnSelect){return a()}};p=function(e){if(!w.allowPast&&parseInt(e.getAttribute("data-time"))<l.getTime()){return false}if(!w.allowToday&&parseInt(e.getAttribute("data-time"))===l.getTime()){return false}if(!w.allowFuture&&parseInt(e.getAttribute("data-time"))>l.getTime()){return false}if(w.allowFrom&&parseInt(e.getAttribute("data-time"))<w.allowFrom.getTime()){return false}if(w.allowTo&&parseInt(e.getAttribute("data-time"))>w.allowTo.getTime()){return false}if(w.range){if(k===null||k!==null&&c!==null){k=new Date(parseInt(e.getAttribute("data-time")));return c=null}else if(parseInt(e.getAttribute("data-time"))>k.getTime()){c=new Date(parseInt(e.getAttribute("data-time")));return C()}}else{k=new Date(parseInt(e.getAttribute("data-time")));c=new Date(parseInt(e.getAttribute("data-time")));return C()}};d=function(e){return v=new Date(parseInt(e.getAttribute("data-time")))};g=function(e,t){var n,r,i,s,o,u,a,f,h,m,g;a=t.getMonth();t.setDate(1);t.setDate(1+(w.weekStart-t.getDay()));b(t);m=L("table",{"class":"ui-calendar-month"},null,e);o=L("thead",{},null,m);n=L("tbody",{},null,m);u=L("tr",{},null,o);s=[];f=L("tr",{},null,n);for(r=g=0;g<35;r=++g){if(r<7){L("th",{},w.dayLabels[t.getDay()],u)}if(t.getMonth()===a||w.fillSpaces){i=L("td",{},t.getDate(),f);i.setAttribute("data-time",t.getTime());i.addEventListener("click",function(e){p(e.toElement||e.target);return A()});i.addEventListener("mouseover",function(e){d(e.toElement||e.target);return A()});s.push(i)}else{i=L("td",{"class":"fill"},"&nbsp;",f);i.setAttribute("data-time",-1)}t.setDate(t.getDate()+1);if(t.getDay()===w.weekStart){f=L("tr",{},null,n)}}return h={update:function(){var e,t,n,r;r=[];for(t=0,n=s.length;t<n;t++){i=s[t];e=[];if(parseInt(i.getAttribute("data-time"))<l.getTime()){e.push("past")}if(parseInt(i.getAttribute("data-time"))===l.getTime()){e.push("today")}if(parseInt(i.getAttribute("data-time"))>l.getTime()){e.push("future")}if(!w.allowToday&&parseInt(i.getAttribute("data-time"))===l.getTime()||!w.allowPast&&parseInt(i.getAttribute("data-time"))<l.getTime()||!w.allowFuture&&parseInt(i.getAttribute("data-time"))>l.getTime()||w.allowFrom&&parseInt(i.getAttribute("data-time"))<w.allowFrom.getTime()||w.allowTo&&parseInt(i.getAttribute("data-time"))>w.allowTo.getTime()){e.push("disabled")}if(k&&parseInt(i.getAttribute("data-time"))===k.getTime()||k&&c&&parseInt(i.getAttribute("data-time"))>=k.getTime()&&parseInt(i.getAttribute("data-time"))<=c.getTime()){e.push("selected")}if(k&&!c&&v&&parseInt(i.getAttribute("data-time"))>k.getTime()&&parseInt(i.getAttribute("data-time"))<v.getTime()){e.push("selection")}r.push(i.setAttribute("class",e.join(" ")))}return r},destroy:function(){return m.parentElement.removeChild(m)}}};N=function(e,t){var n,r,i,s,o,a,f;for(s=0,a=y.length;s<a;s++){i=y[s];i.destroy()}y=[];for(r=o=0,f=w.monthCount||1;0<=f?o<f:o>f;r=0<=f?++o:--o){n=new Date(t.getTime());n.setMonth(n.getMonth()+r);y.push(g(u,n))}return A()};a=function(){if(!f){u.parentElement.removeChild(u)}return f=true};if(w.weekStart===void 0){w.weekStart=1}if(w.monthOffset===void 0){w.monthOffset=1}if(w.monthCount===void 0){w.monthCount=1}if(w.format===void 0){w.format="-"}if(!w.dayLabels){w.dayLabels=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}if(!w.monthLabels){w.monthLabels=["January","February","March","April","May","Jun","July","August","September","October","November","December"]}if(w.closeOnSelect===void 0){w.closeOnSelect=false}if(w.closeOnBlur===void 0){w.closeOnBlur=false}if(w.range===void 0){w.range=false}if(w.fillSpaces===void 0){w.fillSpaces=true}if(w.allowFuture===void 0){w.allowFuture=true}if(w.allowToday===void 0){w.allowToday=true}if(w.allowPast===void 0){w.allowPast=true}w.allowFrom=w.allowFrom?x(w.allowFrom):null;w.allowTo=w.allowTo?x(w.allowTo):null;l=new Date;b(l);if(w.startDate){k=x(w.startDate)}if(w.endDate){c=x(w.endDate)}M=w.initidalDate?x(w.initidalDate):new Date;if(w.range){if(!w.inputFrom||!w.inputTo){throw"Input fields (from & to) are not defined!"}if(w.inputFrom.value.trim()!==""&&w.inputTo.value.trim()!==""){k=x(w.inputFrom.value);c=x(w.inputTo.value);M=new Date(k)}}else{if(!w.input){throw"Input field are not defined!"}if(w.input.value.trim()!==""){k=x(w.input.value);c=new Date(k);M=new Date(k)}}u=L("div",{"class":"ui-calendar"},null,w.container);r=L("div",{"class":"ui-calendar-header"},null,u);n=L("div",{"class":"ui-calendar-body"},null,u);o=L("span",{"class":"ui-calendar-prev"},"◄",r);s=L("span",{"class":"ui-calendar-next"},"►",r);i=L("span",{"class":"ui-calendar-label"},null,r);o.addEventListener("click",function(){M.setMonth(M.getMonth()-1);return N(n,M)});s.addEventListener("click",function(){M.setMonth(M.getMonth()+1);return N(n,M)});u.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();return false});document.body.addEventListener("click",function(e){if(w.closeOnBlur){return a()}});N(n,M);if(w.popup){t=w.input||w.inputFrom;E=t.offsetLeft+Math.round(t.offsetWidth/2);S=t.offsetTop+Math.round(t.offsetHeight/2);T=0;if(S-u.offsetHeight<0){T=1}if(T===1&&E+u.offsetWidth>document.body.clientWidth){T=2}if(T===2&&S+u.offsetHeight>document.body.clientHeight){T=3}switch(T){case 0:u.style.left=E-Math.round(u.offsetWidth/2)+"px";u.style.top=S-u.offsetHeight-t.offsetHeight-5+"px";u.classList.add("ui-calendar-arrow-bot");break;case 1:u.style.left=E+Math.round(t.offsetWidth/2)+20+"px";u.style.top=S-Math.round(u.offsetHeight/2)+"px";u.classList.add("ui-calendar-arrow-left");break;case 2:u.style.left=E-Math.round(u.offsetWidth/2)+"px";u.style.top=S+t.offsetHeight+5+"px";u.classList.add("ui-calendar-arrow-top");break;case 3:u.style.left=E-Math.round(t.offsetWidth/2)-u.offsetWidth-20+"px";u.style.top=S-Math.round(u.offsetHeight/2)+"px";u.classList.add("ui-calendar-arrow-right")}u.classList.add("ui-calendar-arrow");u.classList.add("ui-calendar-popup")}return{getStartDate:function(){return k},getEndDate:function(){return c},close:function(){return a()},isClosed:function(){return f}}};uiCalendarAuto=function(e,t){var n,r,i,s,o,u;if(t==null){t={}}n=function(e){var n,r,i,s,o,u,a,f,l;i={};for(r in t){o=t[r];i[r]=o}i.closeOnSelect=true;i.closeOnBlur=true;i.container=document.body;i.popup=true;if(t.range){i.inputFrom=e.querySelector(i.fromSelector||".start");i.inputTo=e.querySelector(i.toSelector||".end")}else{i.input=e}n=null;f=[i.input,i.inputFrom,i.inputTo];l=[];for(u=0,a=f.length;u<a;u++){s=f[u];if(!s){continue}s.addEventListener("focus",function(){if(!n||n&&n.isClosed()){return n=uiCalendar(i)}});s.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();return false});s.addEventListener("keydown",function(e){if(e.keyCode===27&&n){return n.close()}});s.classList.add("ui-calendar-input");l.push(s.setAttribute("pattern","^([0-9]{1,2}.( )?[0-9]{1,2}.( )?[0-9]{4}|[0-9]{4}-[0-9]{1,2}-[0-9]{1,2})$"))}return l};i=(t.parent||document).querySelectorAll(e);u=[];for(s=0,o=i.length;s<o;s++){r=i[s];u.push(n(r))}return u}